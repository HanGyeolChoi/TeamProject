# 1. 프로젝트 소개

 C#으로 제작된 콘솔 기반의 간단한 텍스트 RPG 게임입니다. 플레이어는 직업을 선택하여 다양한 퀘스트를 수행하고, 몬스터와 전투하며, 던전을 탐험합니다. 상점에서 장비를 구매하고, 던전을 클리어하며 성장할 수 있는 전통적인 RPG 시스템을 갖추고 있습니다.

개발 기간 : 2024.09.26 ~ 2024.10.03

# 2. 팀원 소개 및 역할 분담

| 공동 작업 | 디버깅, 리팩토링 |
| --- | --- |
| 지현민 | 게임 오버 로직, 레벨업 로직, 보상추가 로직 |
| 최한결 | 베이스 프로그램 구현, 클래스 파일 분리, 전투 로직(+치명타, 회피, 스킬) 퀘스트 기능, 콘솔 꾸미기 기능 |
| 한승희 | 몬스터 클래스 생성, 회복하기 로직, 게임 저장하기 기능 |

# 3. 와이어프레임

![image](https://github.com/user-attachments/assets/d3ed2805-bff0-40ad-8de4-6e2940857e12)
https://www.figma.com/board/1qqi9aCDmfZYrx3kmEyVKw/Project_Wireframe?t=DxGkuoCXl3YkAgF5-6

# 4. 클래스별 기능

## Program.cs

| **메서드 이름** | **기능 설명** |
| --- | --- |
| `Main` | 게임의 시작 지점. 초기 데이터를 설정하고 메인 메뉴를 통해 게임을 진행하는 메소드 |
| `Start` | 플레이어의 이름을 입력받고 저장된 데이터를 불러올지 선택하는 메소드 |
| `SelectClass` | 플레이어의 직업을 선택하게 하는 메소드 |
| `MainMenu` | 게임의 메인 메뉴로, 상태 보기, 인벤토리 관리, 상점, 던전 입장 등을 선택하는 메소드 |
| `GameOver` | 플레이어가 게임에서 패배했을 때 호출되는 메소드 |
| `GameClear` | 던전을 클리어했을 때 경험치와 보상을 지급하는 메소드 |

## Character.cs

| **메서드 이름** | **기능 설명** |
| --- | --- |
| `ShowStats` | 플레이어의 상태를 콘솔에 출력하는 메소드 |
| `PrintSimpleStats` | 플레이어의 상태 정보를 간략하게 출력하는 메소드 |
| `ShowInventory` | 인벤토리 아이템을 출력하고 관리할 수 있는 메소드 |
| `ItemManagement` | 인벤토리에서 아이템을 관리하고 장착/해제할 수 있는 메소드 |
| `Buy` | 플레이어가 아이템을 구매할 때 호출되는 메소드 |
| `Sell` | 플레이어가 아이템을 판매할 때 호출되는 메소드 |
| `Equip` | 선택한 아이템을 장착하는 메소드 |
| `Unequip` | 선택한 아이템을 해제하는 메소드 |
| `LevelUp` | 경험치가 충분할 때 레벨업을 수행하는 메소드 |
| `FullExp` | 플레이어의 레벨에 따른 최대 경험치를 반환하는 메소드 |

## Monster.cs

| **메서드 이름** | **기능 설명** |
| --- | --- |
| `IsDead` | 몬스터의 생존 여부를 확인하는 메소드 |

## Dungeon.cs

| **메서드 이름** | **기능 설명** |
| --- | --- |
| `EnterDungeon` | 던전에 입장하여 전투를 시작하는 메소드, 공격, 스킬, 포션 사용 중 선택 |
| `AttackPhase` | 플레이어가 몬스터를 공격하는 전투 단계 메소드 |
| `SkillMenu` | 플레이어가 사용할 스킬을 선택하는 메소드 |
| `EnemyPhase` | 몬스터가 플레이어를 공격하는 단계 메소드 |
| `AttackInput` | 공격 시 플레이어의 입력을 처리하는 메소드 |
| `AttackResult` | 공격 또는 스킬의 결과를 처리하는 메소드 |
| `PrintMonsters` | 던전 내의 몬스터 정보를 출력하는 메소드 |
| `PrintMonstersWithNumber` | 번호를 부여하여 던전 내의 몬스터 정보를 출력하는 메소드 |

## Skill.cs

| **메서드 이름** | **기능 설명** |
| --- | --- |
| `ShowSkill` | 스킬의 이름과 설명을 출력하는 메소드 |
| `UseSkill` | 플레이어가 스킬을 사용할 때 호출되는 메소드, 마나 소모 및 타겟 선택 로직을 포함 |

## Item.cs

| **메서드 이름** | **기능 설명** |
| --- | --- |
| `ShowItem` | 아이템의 정보를 콘솔에 출력하는 메소드 |

## Store.cs

| **메서드 이름** | **기능 설명** |
| --- | --- |
| `StoreMenu` | 상점 메뉴로, 아이템 구매나 판매를 선택할 수 있는 메소드 |
| `BuyMenu` | 상점에서 아이템을 구매하는 로직을 처리하는 메소드 |
| `SellMenu` | 인벤토리에서 아이템을 판매하는 로직을 처리하는 메소드 |

## Heal.cs

| **메서드 이름** | **기능 설명** |
| --- | --- |
| `Rest` | 플레이어가 체력과 마나를 회복하는 로직을 처리하는 메소드 |
| `UsePotion` | 포션을 사용하여 체력을 회복하는 메소드 |
| `GetPotion` | 10% 확률로 포션을 얻는 메소드 |

## Quest.cs

| **메서드 이름** | **기능 설명** |
| --- | --- |
| `QuestMenu` | 플레이어가 선택할 수 있는 퀘스트 목록을 출력하는 메소드 |
| `QuestFirst` | 첫 번째 퀘스트를 처리하는 메소드 |
| `QuestSecond` | 두 번째 퀘스트를 처리하는 메소드 |
| `QuestThird` | 세 번째 퀘스트를 처리하는 메소드 |
| `CheckQuest` | 퀘스트 수락 여부 및 진행 상태를 확인하고, 보상을 지급하는 메소드 |

## UI.cs

| **메서드 이름** | **기능 설명** |
| --- | --- |
| `ShowSelectLoadData` | 저장된 데이터를 불러올지 선택하는 화면을 출력하는 메소드 |
| `ShowSelectSaveData` | 저장할지 선택하는 화면을 출력하는 메소드 |
| `ShowSelectClass` | 직업 선택 화면을 출력하는 메소드 |
| `ShowMainMenu` | 메인 메뉴 화면을 출력하는 메소드 |
| `ShowGameOver` | 게임 오버 시 결과를 출력하는 메소드 |
| `ShowGameClear` | 게임 클리어 시 결과를 출력하는 메소드 |
| `ShowBattleInfo` | 전투 정보(플레이어 상태와 몬스터 상태)를 출력하는 메소드 |
| `ShowEnterDungeon` | 던전에 입장하여 전투 준비 메뉴를 출력하는 메소드 |
| `ShowEnemyPhase` | 몬스터가 플레이어를 공격하는 단계를 출력하는 메소드 |
| `ShowAttackResult` | 스킬 또는 공격의 결과를 출력하는 메소드 |
| `ShowHealMenu` | 체력 회복 메뉴를 출력하는 메소드 |

## Utility.cs

| **메서드 이름** | **기능 설명** |
| --- | --- |
| `CheckInput` | 사용자 입력의 유효성을 검사하는 메소드 |
| `ClearPreviousLines` | 콘솔에서 이전 줄을 지우는 메소드 |
| `WriteLineColoredConsole` | 콘솔에 색을 지정하여 메시지를 출력하는 메소드 |
| `WriteColoredConsole` | 콘솔에 색을 지정하여 문자열을 출력하는 메소드 |
| `GetStringLenghth` | 문자열의 길이를 계산하는 메소드 |
| `SaveData` | 플레이 데이터를 저장하는 메소드 |
| `LoadData` | 저장된 데이터를 불러오는 메소드 |
| `LoadClassData` | 직업별 능력치를 저장한 JSON 데이터를 불러오는 메소드 |
| `LoadSkillData` | 스킬 데이터를 저장한 JSON 데이터를 불러오는 메소드 |

# 5. 트러블슈팅

### 1. 역직렬화 버그 해결

- **문제 상황**
    
    게임 데이터를 저장할 때는 직렬화에 성공했으나, 역직렬화된 데이터를 `LoadData()` 메소드 밖으로 벗어나면 해당 값들이 유지되지 않는 문제가 발생. `LoadData()` 메소드 내에서 데이터가 제대로 로드되었으나, 메소드를 벗어나면 객체가 초기 상태로 돌아가는 현상이 발견됨.
    
- **문제 원인**
    
    `LoadData()` 메소드에서 `player` 객체를 역직렬화하는 과정에서, 역직렬화된 결과가 새로운 객체로 생성되기 때문에 인자로 넘긴 `player` 객체와 동일한 객체가 아니게 됨.
    
    즉, 역직렬화된 데이터는 새로운 객체의 주소에 저장되고, 원래 인자로 전달된 `player` 객체에는 반영되지 않는 문제였음.
    
- **문제 해결**
    
    `player` 객체를 `LoadData()` 메소드로 전달할 때 **참조 전달**을 위해 `ref` 키워드를 사용하여 해결할 수 있음. `ref`를 사용하면 역직렬화된 새로운 객체가 반환되더라도, 원래의 `player` 객체가 참조된 상태로 유지되므로 데이터가 올바르게 반영됨.
    

```csharp
/* 문제 발생 코드*/
static bool LoadData(Character player)
{
      player = JsonConvert.DeserializeObject<Character>(playerJson);
}

```

```csharp
/* 해결된 코드*/
static bool LoadData(ref Character player)
{
      player = JsonConvert.DeserializeObject<Character>(playerJson);
}

```
### 2. 세이브 파일 로드 후 장착 관리 버그

- **문제 상황**
    
    세이브 파일을 로드하여 플레이할 때, 장착 관리가 정상 로직대로 작동하지 않는 문제 발생. 장착한 아이템을 장착 해제하지 못하고, 방어구나 무기가 중복 장착되는 문제 발견함.
    
- **문제 원인**
    
     플레이어 데이터에서 문제가 발생했던 것과 마찬가지로 `LoadData()` 메소드에서 `player` 객체를 역직렬화하는 과정에서, 역직렬화된 결과가 새로운 객체로 생성되기 때문에 인자로 넘긴 `player` 의 `equipedArmor` , `equipedWeapon`객체와 동일한 객체가 아니게 됨. 
    
- **문제 해결**
    
    `Chracter` 의 필드로 참조 형태를 사용하지 않고 장착된 아이템의 인덱스를 저장하도록 수정.
    
    ```csharp
    /* 문제 발생 코드*/
    public class Character
    {
        public Item? equippedArmor;
        public Item? equippedWeapon;
    }
    ```
    
    ```csharp
    /* 해결된 코드*/
    public class Character
    {
        public int equippedArmorNumber;     //장착한 방어구의 index (items 에서)
        public int equippedWeaponNumber;    //장착한 무기의 index
    }
    ```
    
# 6. 리팩토링

### 1. UI와 로직 분리

 게임의 UI와 로직을 분리하여 코드의 가독성과 유지보수성을 개선. `UI` 클래스는 싱글톤 패턴을 사용하여 한 번만 생성되며, 게임 내 다양한 메뉴와 전투 결과 등을 출력하는 데 활용. UI와 게임 로직을 분리함으로써 각 기능의 독립성을 높였으며, UI 수정 시 게임 로직에 영향을 주지 않도록 설계.

### 2. 직업별 능력치 및 스킬 데이터 관리

직업별 능력치와 스킬 데이터를 JSON 파일로 분리하여 관리

- `ClassData.json` 파일은 전사와 도적의 공격력, 방어력, 최대 체력을 저장하여 게임 시작 시 해당 데이터를 불러와 설정
- `SkillData.json` 파일은 각 스킬의 이름, 공격력 배수, 필요 마나, 설명, 타겟 설정 등의 데이터를 포함하고 있으며, 이를 통해 스킬의 효과를 관리

### 3. 스킬, 상점, 힐 기능 분류

스킬, 상점, 힐을 각각의 클래스로 나누어 관리.

- **Skill**: 스킬은 `Skill` 클래스로 정의되며, 스킬 사용 시 공격력 배수와 마나 소모 등을 처리
- **Store**: 상점 기능은 `Store` 클래스로 분리되어 아이템 구매 및 판매를 관리
- **Heal**: 휴식하기 기능은 `Heal` 클래스에서 플레이어의 체력 및 마나를 회복하는 로직을 담당
    
